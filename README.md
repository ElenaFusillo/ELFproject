# B_field

## Introduction

### ELF: Extremely Low Frequency

Low frequency electromagnetic fields, commonly referred to as ELF (Extremely Low Frequency), are emitted at frequencies between 0 Hz and 3000 Hz.
The main artificial sources of ELF fields are the transmission and distribution systems of electricity (power lines) consisting of:

- _power lines_ with different voltage levels, in which alternating electric current flows at a frequency of 50 Hz;
- _substations and electrical transformer cabins_, to transfer electricity between power lines at different voltages.

### Characteristics of power lines

The main characteristics of a power line are the operating voltage (kV) and the carried electric current (A). On the basis of the operating voltage, the power lines are divided into:

- Very High Voltage lines (AAT - 220 kV and 380 kV),
- High Voltage lines (AT - from 40 kV to 150 kV),
- Medium Voltage lines (MT - from 1 kV to 40 kV)
- Low Voltage lines (BT- 380 V and 220 V).

In this project, only AAT, AT and MT power lines will be considered.

### Assessment of human exposure: ARPA

The ascertained effects of low-frequency sources on the human body are essentially related to the intensity of the magnetic field B, which unlike the electric one is not shielded from obstacles such as walls and vegetation. For this reason the magnetic field is more important than the electric one for the protection of the population.

According to the [Legge Quadro 36/01][3], [**ARPA**][2] plays a technical role of support to the public authorities responsible for the health and environmental control and surveillance activity.
The [D.P.C.M. 08.07.2003][3] "Fissazione dei limiti di esposizione, dei valori di attenzione e degli obiettivi di qualità per la protezione della popolazione dalle esposizioni ai campi elettrici e magnetici alla frequenza di rete (50 Hz) generati dagli elettrodotti" establishes three threshold values that apply to different situations:
- _limite di esposizione_ (100 µT) applies to all areas accessible by the population;
- _valore di attenzione_ (10 µT), calculated as the median of the B values over 24 hours, applies to playgrounds, schools and places with daily human presence greater than 4 hours;
- _obiettivo di qualità_ (3 µT), calculated as the median of the B values over 24 hours, is applied in the design of new playgrounds, schools and places with daily human presence greater than 4 hours and in the design of new power lines near these settlements.

The assessment of human exposure to low-frequency electric and magnetic fields is carried out by Arpae in order to assess the impact of the sources on the territory and compare the levels with the limits set by the legislation for the protection of human health. Models and measurements are used in order to verify the compatibility of the territory with the constraint of the buffer zones of the power lines (DPA).

### Distanza di prima approssimazione (DPA)

The magnetic induction field levels generated by the power lines in the area are evaluated through the _DPA (distanza di prima approssimazione)_. That is, the maximum extension of the isoline at 3 µT projected to the ground.\
All distances are to be understood as distances from the axis of the power line considered.

----------------------------

## The project

The code calculates the magnetic induction field values B generated by high (AT) and medium (MT) voltage power lines in a given point of coordinates _(xp, yp)_.

Power lines can be _overhead_ or _underground_. The active conductors, i.e. under voltage and traversed by current, are normally three in number, forming a three-phase _triad_ in which the voltage on the individual conductors is the same, but is out of phase by 120°. Some power lines consist of two triads, and are therefore called _double triads_ (doppia terna). The double triad can be _optimized_ or _non-optimized_. There is an optimized double triad when the pairs of conductors at equal height have different phases and concordant currents or vice versa. The non-optimized double triplet, on the other hand, is when the pairs of conductors at equal height have both the same or different phases and currents.

To perform the calculation, using phasors, it is necessary to provide the current circulating on the line (A), the phase (°) and the spatial configuration of the conductors  (m) in a plane orthogonal to the direction of the current. The given point where the magnetic induction field will be calculated lies in this plane.
These data can be found in the "[Linea Guida ENEL per l'applicazione del punto 5.1.3 dell'Allegato al DM 29.05.08][1]" (published by E-Distribuzione), where some usual configurations are exemplified.

As a reference, a spatial coordinate system must be assumed. Its origin _must_ be placed:
- on the ground, in the center of the trellis' base in case of overhead power lines;
- on the ground, right above the middle line in case of underground power lines (the cables' depth will have negative values).

Moreover, the current phases are usually indicated with integer numbers referring to the numbers on a clock face, where positive angles have counterclockwise orientation starting from 3 as zero angle. Examples:
- 4 - 330°
- 8 - 210°
- 12 - 90°

### Normalized computation model

The calculation methods are described in the two technical standards:
- **CEI 106-11** (Guida per la determinazione delle fasce di rispetto per gli elettrodotti secondo le disposizioni del DPCM 8 luglio 2003 - Linee elettriche aeree e in cavo);
- **CEI 211-4** (Guida ai metodi di calcolo dei campi elettrici e magnetici generati da linee e da stazioni elettriche).

The normalized model for calculating the magnetic induction field B produced in a cross section of an overhead or underground power line is a two-dimensional model that applies the law of Biot-Savart to determine the magnetic induction due to each conductor carried by current and therefore the law of superposition of the effects to determine the total magnetic induction, obviously taking into account the phases of the currents, supposedly symmetrical and balanced.

The following schematizations of the line are assumed:
1. all conductors are considered straight, horizontal, of infinite length and parallel to each other;
2. the currents are considered to be concentrated in the central axes of the overhead conductors or cables;
3. the currents induced respectively in the guard cables for overhead lines and in the shields for underground lines are not considered as their effect on magnetic induction is considered negligible;
4. the ground is considered perfectly transparent from the magnetic point of view and therefore the images of the conductors with respect to the ground are neglected, which at 50 Hz are at very high depths.

The calculation algorithm considers the following steps:
1. the effective values and phases of the sinusoidal currents on the conductors are represented by phasors (complex numbers): _Ii_ is the phasor of the current _i_, on conductor i;
2. with reference to a generic point of coordinates _(xp, yp)_ on the plane orthogonal to the conductors, the phasors of the spatial components of the total magnetic induction _Bx_ and _By_ are calculated through the formulas reported here;

![Formula5_x](https://github.com/ElenaFusillo/ELFproject/blob/main/images/Formula5_x.gif "B_x")         ![Formula5_y](https://github.com/ElenaFusillo/ELFproject/blob/main/images/Formula5_y.gif "B_y")         ![Formula5_z](https://github.com/ElenaFusillo/ELFproject/blob/main/images/Formula5_z.gif "B_z")

3. the effective value of magnetic induction B is obtained with the formula:

![Formula_4](https://github.com/ElenaFusillo/ELFproject/blob/main/images/Formula4.gif)

----------------------------

**TODO** Furthermore, the code estimates the so-called DPA (_distanza di prima approssimazione_) with reference to the limits indicated in the [D.P.C.M. 08.07.2003][3] and graphically represents the results.

----------------------------

## Installation

In order to install the application _B\_field_ you first need to clone the repository [ELFproject](https://github.com/ElenaFusillo/ELFproject) and then use the package manager [pip](https://pip.pypa.io/en/stable/) to install it.
The --editable option is necessary only during the code development in order not to have to reinstall the package at each code modification.

```bash
git clone https://github.com/ElenaFusillo/ELFproject
cd ELFproject
pip install --editable B_field
```

All the  code in this readme must be executed inside a python environment, thus it could be necessary to add `py -m` or `python -m` before the instructions shown.

## Usage

### Input

Once installed, B_field can be exploited through the command line with `B_field <subcommand>`.\
To explore the inputs needed by the subcommands, the command line help can be used via `B_field <subcommand> -h` or `B_field <subcommand> --help`.

**These inputs are mandatory in number and order.**

There are two main subcommands, that are:
- _single_, in case only one triad of cables is considered;
- _double_, in case a double triad of cables is considered.

#### single

Inputs can be provided individually:

```python
B_field single <xp>, <yp>, <I>, <ph_1_deg>, <x1>, <y1>, <ph_2_deg>, <x2>, <y2>, <ph_3_deg>, <x3>, <y3> 
```
or through a configuration file where all the input needed must be listed in order (as the _--help_ shows):

```python
B_field single @<single_arguments.txt>
```

The **@** simbol indicates the input from file.

#### double

Similarly to the previous case, inputs can be provided individually:

```python
B_field double <xp>, <yp>, <A_I>, <A_ph_1_deg>, <A_x1>, <A_y1>, <A_ph_2_deg>, <A_x2>, <A_y2>, <A_ph_3_deg>, <A_x3>, <A_y3>, <B_I>, <B_ph_1_deg>, <B_x1>, <B_y1>, <B_ph_2_deg>, <B_x2>, <B_y2>, <B_ph_3_deg>, <B_x3>, <B_y3> 
```
or through a configuration file where all the input needed must be listed in order (as the _--help_ shows):

```python
B_field double @<double_arguments.txt>
```

The **@** simbol indicates the input from file.

### Output

Once all the input arguments are provided, the code calculates the magnetic induction field values B generated by the given single triad/double triads in the given point _(xp, yp)_. The result is given in microTesla (µT).

----------------------------

## Examples

#### single

Configuration A1 of the [Linea Guida ENEL][1], single triad:

```bash
B_field single @./examples/Argom_Bsingle.txt
In point of coordinates ( -20.5 , 1.0 ), the magnetic induction is  2.99  microTesla.
```

#### double

Configuration A9 of the [Linea Guida ENEL][1], non-optimized balanced double triad:

```bash
B_field double @./examples/Argom_Bdouble.txt
In point of coordinates ( -5.0 , 1.0 ), the magnetic induction is  21.95  microTesla.
```

----------------------------

## Test routines

Tests are stored inside _test_calculations.py_ and _test_cli.py_ files, with the support of all the fixtures needeed contained in _conftest.py_.
In order to perform the tests, it is just necessary to invoke the _pytest_ module:

```bash
pytest
============================= test session starts =============================
platform win32 -- Python 3.9.7, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
rootdir: C:\Users\Elena\Documents\ELFproject
plugins: hypothesis-6.24.0
collected 8 items

test_calculations.py ......                                              [ 75%]
test_cli.py ..                                                           [100%]

============================== 8 passed in 0.05s ==============================
```

----------------------------

## External links

Here are a few useful links:

- [Linea Guida ENEL per l'applicazione del punto 5.1.3 dell'Allegato al DM 29.05.08][1]
- [Arpae - campi elettromagnetici a bassa frequenza (ELF)][2]
- [Normativa nazionale campi elettromagnetici a bassa frequenza][3]
- [Normativa regionale campi elettromagnetici a bassa frequenza](https://www.arpae.it/it/temi-ambientali/campi-elettromagnetici/normativa/normativa-regionale/normativa-regionale-cem-a-bassa-frequenza)

[1]:https://www.e-distribuzione.it/content/dam/e-distribuzione/documenti/connessione_alla_rete/regole_tecniche/LineaGuidaDPA.pdf
[2]:https://www.arpae.it/it/temi-ambientali/campi-elettromagnetici/scopri-di-piu/campi-elettromagnetici-a-bassa-frequenza
[3]:https://www.arpae.it/it/temi-ambientali/campi-elettromagnetici/normativa/normativa-nazionale/normativa-nazionale-campi-elettromagnetici-a-bassa-frequenza

## Contacts
-----------

**Author:**

Elena Fusillo\
efusillo@arpae.it\
Arpae, Agenzia regionale per la prevenzione, l'ambiente e l'energia dell'Emilia Romagna\
Via Guido Alberoni, 17\
48121 Ravenna (RA), Italy

## License
[CC0 1.0 UNIVERSAL](https://creativecommons.org/publicdomain/zero/1.0/legalcode)
